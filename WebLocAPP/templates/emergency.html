{% extends "base.html" %}

{% block title %}Urgences - Administration LocApp{% endblock %}

{% block content %}
<div class="admin-layout">
    <div class="admin-form-section">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">NumÃ©ros d'urgence</h2>
            </div>

            <div class="info-box">
                <strong>Information:</strong> Les numÃ©ros d'urgence sont prÃ©-configurÃ©s et ne peuvent pas Ãªtre modifiÃ©s pour des raisons de sÃ©curitÃ©.
            </div>

            <table class="table" style="margin-top: 1.5rem;">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>NumÃ©ro</th>
                        <th>CatÃ©gorie</th>
                    </tr>
                </thead>
                <tbody id="emergencyTable">
                    <tr>
                        <td colspan="3" class="empty-state">Chargement...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="admin-preview-section">
        <p class="preview-title">AperÃ§u mobile - Urgences</p>
        <div class="mini-iphone">
            <div class="iphone-notch"></div>
            <div class="iphone-screen">
                <div class="status-bar">
                    <span>Urgences</span>
                </div>
                <div class="app-content">
                    <div class="preview-content">
                        <div class="preview-card" style="background: #fef2f2; text-align: center; margin-bottom: 12px;">
                            <span style="font-size: 32px;">ðŸ†˜</span>
                            <p style="font-size: 10px; color: #b91c1c; margin-top: 4px;"><strong>NumÃ©ros d'urgence</strong></p>
                            <p style="font-size: 8px; color: #ef4444;">En cas d'urgence, appelez directement</p>
                        </div>

                        <div class="preview-section-title">Services d'urgence</div>
                        <div class="preview-card" id="preview-emergency-list">
                            <div class="preview-emergency-item">
                                <span>ðŸš‘</span>
                                <strong>SAMU</strong>
                                <span class="number">15</span>
                            </div>
                            <div class="preview-emergency-item">
                                <span>ðŸš’</span>
                                <strong>Pompiers</strong>
                                <span class="number">18</span>
                            </div>
                            <div class="preview-emergency-item">
                                <span>ðŸ‘®</span>
                                <strong>Police</strong>
                                <span class="number">17</span>
                            </div>
                            <div class="preview-emergency-item">
                                <span>ðŸ‡ªðŸ‡º</span>
                                <strong>Urgences Europe</strong>
                                <span class="number">112</span>
                            </div>
                        </div>

                        <div class="preview-card" style="background: #fffbeb; margin-top: 12px;">
                            <div class="preview-card-header">
                                <span>ðŸ’¡</span>
                                <strong>Conseil</strong>
                            </div>
                            <p>Le 112 fonctionne partout en Europe et peut Ãªtre composÃ© mÃªme sans rÃ©seau.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const emergencyIcons = {
    'SAMU': 'ðŸš‘',
    'Pompiers': 'ðŸš’',
    'Police': 'ðŸ‘®',
    'Urgences Europe': 'ðŸ‡ªðŸ‡º'
};

async function loadData() {
    try {
        const data = await fetchAPI('/api/emergency');
        const tableBody = document.getElementById('emergencyTable');
        const previewList = document.getElementById('preview-emergency-list');

        if (data && data.length > 0) {
            tableBody.innerHTML = data.map(item => `
                <tr>
                    <td>${emergencyIcons[item.name] || 'ðŸ“ž'} ${item.name}</td>
                    <td><strong>${item.number}</strong></td>
                    <td><span class="badge badge-warning">${item.category}</span></td>
                </tr>
            `).join('');

            previewList.innerHTML = data.map(item => `
                <div class="preview-emergency-item">
                    <span>${emergencyIcons[item.name] || 'ðŸ“ž'}</span>
                    <strong>${item.name}</strong>
                    <span class="number">${item.number}</span>
                </div>
            `).join('');
        } else {
            tableBody.innerHTML = '<tr><td colspan="3" class="empty-state">Aucun numÃ©ro d\'urgence configurÃ©</td></tr>';
        }
    } catch (error) {
        showAlert('Erreur lors du chargement des donnÃ©es', 'error');
    }
}

loadData();
</script>
{% endblock %}
